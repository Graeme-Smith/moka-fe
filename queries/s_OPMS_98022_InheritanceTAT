SELECT TOP 24 Format([ArrayResultDate],"yyyy") & "-" & Format(Format([ArrayResultDate],"mm"),"00") AS [Month], Count(ArrayTest.ArrayTestID) AS CountOfArrayTestID, Sum(IIf(DateDiff("d",[dbo_specimenlinked].[DateReceived],[ArrayTest].[ArrayResultDate])<=42,1,0)) AS Count42days, Sum(IIf(DateDiff("d",[dbo_specimenlinked].[DateReceived],[ArrayTest].[ArrayResultDate])<=28,1,0)) AS Count28days, Sum(IIf(DateDiff("d",[dbo_specimenlinked].[DateReceived],[ArrayTest].[ArrayResultDate])<=28,1,0))/Count([arraytestid]) AS 28days, Sum(IIf(DateDiff("d",[dbo_specimenlinked].[DateReceived],[ArrayTest].[ArrayResultDate])<=35,1,0))/Count([arraytestid]) AS 35days, Sum(IIf(DateDiff("d",[dbo_specimenlinked].[DateReceived],[ArrayTest].[ArrayResultDate])<=42,1,0))/Count([arraytestid]) AS 42days, Sum(IIf(DateDiff("d",[dbo_specimenlinked].[DateReceived],[ArrayTest].[ArrayResultDate])<=49,1,0))/Count([arraytestid]) AS 49days, Sum(IIf(DateDiff("d",[dbo_specimenlinked].[DateReceived],[ArrayTest].[ArrayResultDate])<56,1,0))/Count([arraytestid]) AS 56days, (Avg(DateDiff("d",[dbo_specimenlinked].[DateReceived],[ArrayTest].[ArrayResultDate])))+2 AS TATMeanAll, StDev(DateDiff("d",[dbo_specimenlinked].[DateReceived],[ArrayTest].[ArrayResultDate]))/Avg(DateDiff("d",[dbo_specimenlinked].[DateReceived],[ArrayTest].[ArrayResultDate])) AS CV
FROM ArrayTest INNER JOIN dbo_specimenlinked ON ArrayTest.SpecimenNo = dbo_specimenlinked.SpecimenTrustID
WHERE (((ArrayTest.ReferralID)=1185356886 Or (ArrayTest.ReferralID)=1199901176 Or (ArrayTest.ReferralID)=1199901175) AND ((ArrayTest.StatusID)=4) AND ((ArrayTest.Service)=True))
GROUP BY Format([ArrayResultDate],"yyyy") & "-" & Format(Format([ArrayResultDate],"mm"),"00")
ORDER BY Format([ArrayResultDate],"yyyy") & "-" & Format(Format([ArrayResultDate],"mm"),"00") DESC;
