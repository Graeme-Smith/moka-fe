SELECT TOP 64 Format([DateAuthorized],"yyyy") & "-" & Format(Format([DateAuthorized],"ww"),"00") AS WeekNo, FormatDateTime(([DateAuthorized])-(Weekday([DateAuthorized])-2),2) AS Week, Count(ArrayTest.ArrayTestID) AS Reports, Sum(IIf(DateDiff("d",[dbo_Specimen_Table].[DateReceived],[dbo_SpecimenReportLinked].[DateAuthorized])<28,1,0)) AS Count28days, Sum(IIf(DateDiff("d",[dbo_Specimen_Table].[DateReceived],[dbo_SpecimenReportLinked].[DateAuthorized])<28,1,0))/Count([arraytestid]) AS 28days, Avg(DateDiff("d",[dbo_Specimen_Table].[DateReceived],[dbo_SpecimenReportLinked].[DateAuthorized])) AS TATMeanAll, StDev(DateDiff("d",[dbo_Specimen_Table].[DateReceived],[dbo_SpecimenReportLinked].[DateAuthorized]))/Avg(DateDiff("d",[dbo_Specimen_Table].[DateReceived],[dbo_SpecimenReportLinked].[DateAuthorized])) AS CV
FROM ArrayTest INNER JOIN (dbo_SpecimenReportLinked INNER JOIN dbo_Specimen_Table ON dbo_SpecimenReportLinked.SpecimenID = dbo_Specimen_Table.SpecimenID) ON ArrayTest.SpecimenNo = dbo_Specimen_Table.SpecimenTrustID
WHERE (((ArrayTest.ReferralID)=2 Or (ArrayTest.ReferralID)=1199901192 Or (ArrayTest.ReferralID)=1199901183) AND ((ArrayTest.Priority)=False) AND ((dbo_SpecimenReportLinked.Description)="7a - aCGH general - Viapath") AND ((DateDiff("d",[dbo_Specimen_Table].[DateReceived],[dbo_SpecimenReportLinked].[DateAuthorized]))<100))
GROUP BY Format([DateAuthorized],"yyyy") & "-" & Format(Format([DateAuthorized],"ww"),"00"), FormatDateTime(([DateAuthorized])-(Weekday([DateAuthorized])-2),2)
ORDER BY Format([DateAuthorized],"yyyy") & "-" & Format(Format([DateAuthorized],"ww"),"00") DESC;
