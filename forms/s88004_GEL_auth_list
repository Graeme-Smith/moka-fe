Option Compare Database


Private Sub Check4ID_Change()
    Dim usr As String
    Dim dt As String
    Dim cmp As String
    Dim strPatLogTest As String
    Dim strmemo As String
    
    ' update check4 date
    Me.Check4Date = Now
    
    ' set time, user and computer names for logs
    dt = Format(Now, "dd/mmm/yyyy Hh:Nn:ss")
    usr = VBA.Environ("USERNAME")
    cmp = VBA.Environ("COMPUTERNAME")
    ' create sql to insert into patient log and NGS log
    strPatLogTest = "INSERT INTO PatientLog(InternalPatientID, LogEntry, [Date], Login, PCName) VALUES(" & Me.InternalPatientID & ", 'NGS: GeL authorising scientist changed to " & Me.Check4ID.Column(1) & ".',#" + dt + "#,'" + usr + "','" + cmp + "')"
    strmemo = "INSERT INTO NGSLogMemo(InternalPatientID, Type, LinkID, LogMemoEntry, [Date], Login, PCName) VALUES(" & Me.InternalPatientID & ", 3, " & Me.NGSTestID & ",'NGS: GeL authorising scientist changed to " & Me.Check4ID.Column(1) & ".',#" + dt + "#,'" + usr + "','" + cmp + "')"
    
    DoCmd.SetWarnings False
    DoCmd.RunSQL strPatLogTest
    DoCmd.RunSQL strmemo
    DoCmd.SetWarnings True
End Sub



Private Sub Status_AfterUpdate()
    Dim usr As String
    Dim dt As String
    Dim cmp As String
    Dim strPatLogTest As String
    Dim strmemo As String
    
    ' set time, user and computer names for logs
    dt = Format(Now, "dd/mmm/yyyy Hh:Nn:ss")
    usr = VBA.Environ("USERNAME")
    cmp = VBA.Environ("COMPUTERNAME")
        
    ' change status to complete, setting check4ID, check4Date and status
    If Me.Status.Column(0) = 4 Then
        ' query that sets the check4 info and the status
        sqlUpdateChecker = "update NGSTEST, checker set ngstest.check4ID = checker.check1ID, ngstest.check4date = #" + dt + "#, NGSTest.statusID = 4 where checker.username = '" + usr + "' and NGSTestID = " & Me.NGSTestID.Value
        ' create sql to insert into patient log and NGS log
        strPatLogTest = "INSERT INTO PatientLog(InternalPatientID, LogEntry, [Date], Login, PCName) VALUES(" & InternalPatientID & ", 'NGS: GeL test status changed to Complete. GeL authorising scientist changed to " + usr + " and check4date updated with current timestamp',#" + dt + "#,'" + usr + "','" + cmp + "')"
        strmemo = "INSERT INTO NGSLogMemo(InternalPatientID, Type, LinkID, LogMemoEntry, [Date], Login, PCName) VALUES(" & Me.InternalPatientID & ", 3, " & Me.NGSTestID & ",'NGS: GeL test status changed to Complete. GeL authorising scientist changed to " + usr + " and check4date updated with current timestamp' ,#" + dt + "#,'" + usr + "','" + cmp + "')"
        ' execute all three queries
        DoCmd.SetWarnings False
        DoCmd.RunSQL sqlUpdateChecker
        DoCmd.RunSQL strPatLogTest
        DoCmd.RunSQL strmemo
        DoCmd.SetWarnings True
    ' if status has been changed to complete double clicking will undo this change - setting check4 to null and status back to authorisation
    Else
        ' query that empties the check4 info and resets the status
        sqlUpdateChecker = "update NGSTEST set ngstest.check4ID = NULL, ngstest.check4date = NULL, NGSTest.statusID = " & Me.Status.Column(0) & " where NGSTestID = " & Me.NGSTestID.Value
        ' create sql to insert into patient log and NGS log to say status changed and check4 set to null
        strPatLogTest = "INSERT INTO PatientLog(InternalPatientID, LogEntry, [Date], Login, PCName) VALUES(" & InternalPatientID & ", 'NGS: GeL test status changed to " + Me.Status.Column(1) + ". GeL authorising scientist changed to NULL and timestamp removed',#" + dt + "#,'" + usr + "','" + cmp + "')"
        strmemo = "INSERT INTO NGSLogMemo(InternalPatientID, Type, LinkID, LogMemoEntry, [Date], Login, PCName) VALUES(" & Me.InternalPatientID & ", 3, " & Me.NGSTestID & ",'NGS: GeL test status changed to " + Me.Status.Column(1) + ". GeL authorising scientist changed to NULL and timestamp removed' ,#" + dt + "#,'" + usr + "','" + cmp + "')"
        ' execute all three queries
        DoCmd.SetWarnings False
        DoCmd.RunSQL sqlUpdateChecker
        DoCmd.RunSQL strPatLogTest
        DoCmd.RunSQL strmemo
        DoCmd.SetWarnings True
    End If

End Sub

Private Sub Review_variants_URL_Click()
    Call firefoxurl(Review_variants_URL.Value)
End Sub

